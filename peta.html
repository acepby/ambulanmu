<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>AmbulanMu</title>
        <link
            rel="stylesheet"
            type="text/css"
            href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css"/>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"
            type="text/javascript">
        </script>
        <script
			src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-realtime/2.2.0/leaflet-realtime.min.js"
			type="text/javascript">
		</script>
        <style>
            #map {
                position: absolute;
                top: 0;
                left: 0;
                bottom: 0;
                right: 0;
            }
        </style>
    </head>
    <body>
        <div id="map">
        </div>
        <script>
            // set up map
            var center = [-1.328499, 121.589203];
            var url = "ambulan.geojson"
            
            function createRealtimeLayer(url) {
				return L.realtime(url, {
					interval: 60 * 1000,
					getFeatureId: function(f) {
						return f.properties.driver;
					},
					cache: true,
					
					onEachFeature(f, l) {
						l.bindPopup(function() {
							return '<h3>' + f.properties.driver + '</h3>' +
								'<p>' + f.properties.state +'</p>' +
								'<b>'+ f.properties.upid +'</b>'+
								'<p>' + new Date(f.properties.waktu);
						});
					}
				});
			}
			
			var map = L.map('map').setView(center, 6);
			var ambulan = createRealtimeLayer(url);
			ambulan.addTo(map)
			ambulan.once('update', function() {
                                map.fitBounds(ambulan.getBounds(), {maxZoom:8});
                        });

            // Stamen's Toner basemap
            L.tileLayer(
                'https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.png', {
                    attribution: 'Map tiles by <a href="http://stamen.com">' +
                        'Stamen Design</a>, under' +
                        '<a href="http://creativecommons.org/licenses/by/3.0">' +
                        'CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">' +
                        'OpenStreetMap</a>, under' +
                        '<a href="http://www.openstreetmap.org/copyright">ODbL</a>.'
            }).addTo(map);
        </script>
    </body>
</html>
